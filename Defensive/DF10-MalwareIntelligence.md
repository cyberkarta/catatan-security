# Malware Intelligence
#defensive #malware 

## Yara
https://github.com/InQuest/awesome-yara
Tool multi-platform untuk matching sifat-sifat dari malicious file, mengkategorisasi malware berdasarkan sifat-sifatnya. Yara dapat digunakan sebagai malware intelligence.

### Syntax
```sh
rule rulename
  {
    meta:
      author = "cyberkarta"
      description = "test rule"
      created = "1/12/2021 00:00"
    strings:
      $textstring = "text"
      $hexstring = {4D 5A}
    conditions:
      $textstring and $hexstring
  }
```

Syntax dasarnya dimulai dengan rule dan dilanjutkan dengan meta (isi dari metadata)

Meta sifatnya opsional sebagai informasi dari rule tersebut untuk membantu analyst. Contoh dari meta adalah **author, description, created**.

String adalah bagian yang ingin dicocokkan dengan dalam Yara. Deklarasinya menggunakan `$` dilanjutkan dengan nama variabel. String dapat berupa text string (diapit dengan " ") dan hex string (menggunakan { }).

Condition adalah aturan agar rule cocok dengan file, condition harus dituliskan dengan urutan yang benar. Operator yang dapat digunakan biasanya adalah **and, or, not**. 

```sh
rule eicaryara  {
  meta:
    author="cyberkarta"
    description="eicar string"
  strings:
    $a="X5O"
    $b="EICAR"
    $c="ANTIVIRUS"
    $d="TEST"
  condition:
    $a and $b and $c and $d
}
```

### Eksekusi
```sh
yara [options] rule_file [target]

-m: membaca metadata
-s: membaca string yang cocok dengan targetnya
```

### Referensi Bagus
- Signature YARA pada scanner LOKI dan THOR Lite  https://github.com/Neo23x0/signature-base
- Yara Rules dari komunitas: https://github.com/Yara-Rules/rules

## VirusTotal
Replikasi deteksi malware dari berbagai macam antivirus. Submit file berisi virus, hash, ataupun URL ke https://www.virustotal.com/gui/home/upload. VirusTotal juga dapat membaca Yara file untuk melakukan automasi, setting notifikasi, dan bahkan melakukan scanning ke seluruh database VirusTotal dengan ruleset Yara tersebut.

Contoh: Zeus Trojan (pencuri akun bank) : aaed3b36a177c360871f7b38401cbc892dfa3c8833b7840f2dc660acec511f8b
![](attachments/Pasted%20image%2020211224172616.png)

### Informasi yang dapat diambil:
Deteksi dari berbagai antivirus

Tab detail berisi berbagai atribut dari malware tersebut, termasuk informasi tentang target dari mesin.
![](attachments/Pasted%20image%2020211224180211.png)

Tab Behavior berisi perilaku dari malware selama dalam sistem dan bisa jadi dari berbagai macam sandbox.
![](attachments/Pasted%20image%2020211224180402.png)

### Graph
Graph pada https://www.virustotal.com/graph/ dapat membantu menemukan relasi dari file tersebut terhadap IP address, domain, ASN, atau file lainnya. Contoh pada file 
`dd20c919bf892cf7094da65410d55c6b9afeaa55e920976c570f0e15e7334697` lakukan full expansion pada salah satu node untuk melihat relasinya.  Cobalah file malware crypto mining sebagai testing, karena tipe malware ini biasanya memiliki banyak relasi.

![](attachments/Pasted%20image%2020211224181828.png)

Kamu dapat memilih beberapa node dengan menekan tombol shift dan mencari persamaan dari masing-masing node.

Graph tersebut dapat disimpan dan di-share kepada orang lain dengan menggunakan link maupun embded ke website.

