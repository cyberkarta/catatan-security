# Wireshark
#sniffing #general 

## Metode Koleksi
1. Network taps: vampire tap / inline tap
2. MAC flood Switch (be careful)
3. ARP Poisoning (usually used to sniff packets)
4. Wifi Promiscious Mode

## Capture Filter
https://wiki.wireshark.org/CaptureFilters

Capture filter bukan display filter. Valuenya tidak bisa diubah ketika sudah start capture. Dipakai untuk mengurangi ukuran packet capture.
![](attachments/Pasted%20image%2020220415104550.png)

```sh
host 10.1.1.1

# range
net 10.1.1.0/24
net 10.1.1
net 10.1.1.0 netmask 255.255.255.0

# source & destination
src net 10.1.1.0/24
src host 10.1.1.1
dst net 10.1.2.0/24

# capture certain port
port 53
tcp portrange 1500-1599

# exclusion
port not 53 and not arp

# complex
host www.example.com and not (port 80 or port 25)
host www.example.com and not port 80 and not port 25

# caputre EAPOL
ether proto 0x888e

# 

# capture ipv4 packet, get rid ARP and STP
ip

```

Capture Blaster worms
```
 (tcp dst port 135 or tcp dst port 4444 or udp dst port 69) and ip[2:2]==48
```

Capture Welchia worms
```
icmp[icmptype]==icmp-echo and ip[2:2]==92 and icmp[8:4]==0xAAAAAAAA
```

Capture most worms: beroperasi pada port 135, 445, dan 1433
```
dst port 135 or dst port 445 or dst port 1433  and tcp[tcpflags] & (tcp-syn) != 0 and tcp[tcpflags] & (tcp-ack) = 0 and src net 192.168.0.0/24
```

Heartbleed exploit
```
tcp src port 443 and (tcp[((tcp[12] & 0xF0) >> 4 ) * 4] = 0x18) and (tcp[((tcp[12] & 0xF0) >> 4 ) * 4 + 1] = 0x03) and (tcp[((tcp[12] & 0xF0) >> 4 ) * 4 + 2] < 0x04) and ((ip[2:2] - 4 * (ip[0] & 0x0F)  - 4 * ((tcp[12] & 0xF0) >> 4) > 69))
```
WLAN traffic
```
link[0] != 0x80
```

VLAN
```
vlan
vlan and (host 192.168.0.0 and port 80)
```
## Display Filter
Wireshark syntax untuk mencari lokasi pada protocol.

```sh
ip.addr == 10.1.1.1
ip.src == 10.1.1.1
ip.dst == 10.1.1.1

ip.addr == 10.
ip.src == 10.43.54.65 or ip.dst == 10.43.54.65

! ( ip.addr == 10.43.54.65 )


eth.addr == aa:aa:aa:aa:aa:aa
eth.src == aa:aa:aa:aa:aa:aa
eth.dst == aa:aa:aa:aa:aa:aa

tcp.port == 3389
udp.port == 53
not tcp.port == 3389

icmp
dns
arp

http
http contains google.com
http.request.method == GET
```

DNS
Mencari response dari A record dari query packet.tryhackme.com dan transactionID 0xef8e.
```BPF
response 0xef8e A packet.tryhackme.com
```

ARP reply 
https://www.wireshark.org/docs/dfref/a/arp.html
```
( arp.src.proto_ipv4 == 192.168.1.2 ) && ( arp.opcode==1 )
```

Match DELL mac Address
```
eth.addr[0:3]==00:06:5B
```

TCP buffer full
```
tcp.window_size == 0 && tcp.flags.reset != 1
```

Match packets containing the (arbitrary) 3-byte sequence 0x81, 0x60, 0x03 at the beginning of the UDP payload.
```
udp[8:3]==81:60:03
```
Match HTTP requests where the last characters in the uri are the characters "gl=se":
```
http.request.uri matches "gl=se$"
```

## DLL
**HTTP Object**
File > Export Objects > HTTP

**Capture HTTPS packet and read (TLS key needed)**
Edit > Preferences > Protocols > TLS > +
Load RSA key
Input IP address
Port: start_tls
Protocol: http
Keyfile: RSA key location

Kemudian traffic HTTPS akan terdekripsi oleh capture pada Wireshark


## Sample Captures
https://wiki.wireshark.org/SampleCaptures

## CheatSheet
https://packetlife.net/blog/2008/oct/18/cheat-sheets-tcpdump-and-wireshark/